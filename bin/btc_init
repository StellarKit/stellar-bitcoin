#!/bin/bash

set -ex

mkdir -p $HOME/.bitcoin

echo "Creating bitcoin.conf"

# Seed a random password for JSON RPC server
cat <<EOF > $HOME/.bitcoin/bitcoin.conf
prune=${PRUNE:-0}
testnet=${TESTNET:-1}
regtest=${REGTEST:-0}
disablewallet=${DISABLEWALLET:-1}
printtoconsole=${PRINTTOCONSOLE:-1}
EOF

[[ -n $RPCUSER ]] && echo "rpcuser=${RPCUSER}" >> $HOME/.bitcoin/bitcoin.conf
[[ -n $RPCPASSWORD ]] && echo "rpcpassword=${RPCPASSWORD}" >> $HOME/.bitcoin/bitcoin.conf
[[ -n $TXINDEX ]] && echo "txindex=1" >> $HOME/.bitcoin/bitcoin.conf

cat $HOME/.bitcoin/bitcoin.conf

echo "Initialization completed successfully"
